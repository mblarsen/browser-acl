let e=(()=>{class e{constructor({strict:e=!1}={}){this.strict=e,this.rules=new Map,this.policies=new Map,this.registry=new WeakMap}rule(t,r,s=!0){let i;var o;"boolean"==typeof(o=r)||void 0===o||"function"==typeof o&&""===o.name?(s=void 0===r||r,i=e.GlobalRule):i=r;const n=this.verbObjectMapper(i);return(Array.isArray(t)?t:[t]).forEach(e=>{const t=this.rules.get(n)||{};t[e]=s,this.rules.set(n,t)}),this}policy(e,t){const r="function"==typeof e?new e:e,s=this.verbObjectMapper(t);return this.policies.set(s,r),this}register(e,t){return this.registry.set(e,t),this}can(t,r,s,...i){const o=this.verbObjectMapper(s=void 0===s?e.GlobalRule:s),n=this.policies.get(o),c=n||this.rules.get(o);if(void 0===c){if(this.strict)throw new Error(`No rules for verb object "${o}"`);return!1}if(n&&"function"==typeof n.beforeAll){const e=n.beforeAll(r,t,s,o,...i);if(void 0!==e)return e}if("function"==typeof c[r])return Boolean(c[r](t,s,o,...i));if(this.strict&&void 0===c[r])throw new Error(`Unknown verb "${r}"`);return Boolean(c[r])}some(e,t,r,...s){return r.some(r=>this.can(e,t,r,...s))}every(e,t,r,...s){return r.every(r=>this.can(e,t,r,...s))}mixin(e){const t=this;return e.prototype.can=function(e,r,...s){return t.can(this,e,r,...s)},e.prototype.can.every=function(e,r,...s){return t.every(this,e,r,...s)},e.prototype.can.some=function(e,r,...s){return t.some(this,e,r,...s)},this}verbObjectMapper(e){return"string"==typeof e?e:this.registry.has(e)?this.registry.get(e):this.registry.has(e.constructor)?this.registry.get(e.constructor):"function"==typeof e?e.name:e.constructor.name}reset(){return this.rules=new Map,this.policies=new Map,this.registry=new WeakMap,this}removeRules(e,t=null){const r=this.verbObjectMapper(e);if(this.rules.has(r)){if(t){const e=this.rules.get(r);return e&&delete e[t],this}this.rules.delete(r)}return this}removePolicy(e){const t=this.verbObjectMapper(e);return this.policies.delete(t),this}removeAll(e){return this.removeRules(e),this.removePolicy(e),this}}return e.GlobalRule="GLOBAL_RULE",e})();export default e;
//# sourceMappingURL=index.modern.js.map
